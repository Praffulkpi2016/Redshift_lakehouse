DROP TABLE IF EXISTS silver_bec_ods.AP_INV_APRVL_HIST_ALL;
CREATE TABLE IF NOT EXISTS silver_bec_ods.AP_INV_APRVL_HIST_ALL (
  APPROVAL_HISTORY_ID DECIMAL(15, 0),
  INVOICE_ID DECIMAL(15, 0),
  ITERATION DECIMAL(9, 0),
  RESPONSE STRING,
  APPROVER_ID DECIMAL(15, 0),
  APPROVER_NAME STRING,
  AMOUNT_APPROVED DECIMAL(28, 10),
  APPROVER_COMMENTS STRING,
  CREATED_BY DECIMAL(15, 0),
  CREATION_DATE TIMESTAMP NOT NULL,
  LAST_UPDATE_DATE TIMESTAMP NOT NULL,
  LAST_UPDATED_BY DECIMAL(15, 0),
  LAST_UPDATE_LOGIN DECIMAL(15, 0),
  ORG_ID DECIMAL(15, 0),
  NOTIFICATION_ORDER DECIMAL(9, 0),
  ORIG_SYSTEM STRING,
  ITEM_CLASS STRING,
  ITEM_ID STRING,
  LINE_NUMBER DECIMAL(15, 0),
  HOLD_ID DECIMAL(15, 0),
  HISTORY_TYPE STRING,
  `APPROVER_COMMENTS#1` STRING,
  `LINE_NUMBER#1` DECIMAL(28, 10),
  KCA_OPERATION STRING,
  IS_DELETED_FLG STRING,
  kca_seq_id DECIMAL(36, 0),
  kca_seq_date TIMESTAMP
);
INSERT INTO silver_bec_ods.AP_INV_APRVL_HIST_ALL (
  APPROVAL_HISTORY_ID,
  INVOICE_ID,
  ITERATION,
  RESPONSE,
  APPROVER_ID,
  APPROVER_NAME,
  AMOUNT_APPROVED,
  APPROVER_COMMENTS,
  CREATED_BY,
  CREATION_DATE,
  LAST_UPDATE_DATE,
  LAST_UPDATED_BY,
  LAST_UPDATE_LOGIN,
  ORG_ID,
  NOTIFICATION_ORDER,
  ORIG_SYSTEM,
  ITEM_CLASS,
  ITEM_ID,
  LINE_NUMBER,
  HOLD_ID,
  HISTORY_TYPE,
  `APPROVER_COMMENTS#1`,
  `LINE_NUMBER#1`,
  kca_operation,
  IS_DELETED_FLG,
  kca_seq_id,
  kca_seq_date
)
SELECT
  APPROVAL_HISTORY_ID,
  INVOICE_ID,
  ITERATION,
  RESPONSE,
  APPROVER_ID,
  APPROVER_NAME,
  AMOUNT_APPROVED,
  APPROVER_COMMENTS,
  CREATED_BY,
  CREATION_DATE,
  LAST_UPDATE_DATE,
  LAST_UPDATED_BY,
  LAST_UPDATE_LOGIN,
  ORG_ID,
  NOTIFICATION_ORDER,
  ORIG_SYSTEM,
  ITEM_CLASS,
  ITEM_ID,
  LINE_NUMBER,
  HOLD_ID,
  HISTORY_TYPE,
  `APPROVER_COMMENTS#1`,
  `LINE_NUMBER#1`,
  KCA_OPERATION,
  'N' AS IS_DELETED_FLG,
  CAST(NULLIF(KCA_SEQ_ID, '') AS DECIMAL(36, 0)) AS KCA_SEQ_ID,
  kca_seq_date
FROM bronze_bec_ods_stg.AP_INV_APRVL_HIST_ALL;
UPDATE bec_etl_ctrl.batch_ods_info SET load_type = 'I', last_refresh_date = CURRENT_TIMESTAMP()
WHERE
  ods_table_name = 'ap_inv_aprvl_hist_all';
DROP TABLE IF EXISTS silver_bec_ods.MSC_SAFETY_STOCKS;
CREATE TABLE IF NOT EXISTS silver_bec_ods.MSC_SAFETY_STOCKS (
  plan_id DECIMAL(15, 0),
  organization_id DECIMAL(15, 0),
  sr_instance_id DECIMAL(15, 0),
  inventory_item_id DECIMAL(15, 0),
  period_start_date TIMESTAMP,
  safety_stock_quantity DECIMAL(28, 10),
  updated DECIMAL(15, 0),
  status DECIMAL(15, 0),
  refresh_number DECIMAL(15, 0),
  last_update_date TIMESTAMP,
  last_updated_by DECIMAL(15, 0),
  creation_date TIMESTAMP,
  created_by DECIMAL(15, 0),
  last_update_login DECIMAL(15, 0),
  request_id DECIMAL(15, 0),
  program_id DECIMAL(15, 0),
  program_update_date TIMESTAMP,
  program_application_id DECIMAL(15, 0),
  target_safety_stock DECIMAL(28, 10),
  project_id DECIMAL(15, 0),
  task_id DECIMAL(15, 0),
  planning_group STRING,
  user_defined_safety_stocks DECIMAL(28, 10),
  user_defined_dos DECIMAL(15, 0),
  target_days_of_supply DECIMAL(15, 0),
  achieved_days_of_supply DECIMAL(15, 0),
  unit_number STRING,
  demand_var_ss_percent DECIMAL(28, 10),
  mfg_ltvar_ss_percent DECIMAL(28, 10),
  transit_ltvar_ss_percent DECIMAL(28, 10),
  sup_ltvar_ss_percent DECIMAL(28, 10),
  total_unpooled_safety_stock DECIMAL(28, 10),
  item_type_id DECIMAL(15, 0),
  item_type_value DECIMAL(15, 0),
  new_plan_id DECIMAL(15, 0),
  simulation_set_id DECIMAL(15, 0),
  new_plan_list STRING,
  applied DECIMAL(15, 0),
  reserved_safety_stock_qty DECIMAL(28, 10),
  inventory_level DECIMAL(15, 0),
  kca_operation STRING,
  is_deleted_flg STRING,
  kca_seq_id DECIMAL(36, 0),
  kca_seq_date TIMESTAMP
);
INSERT INTO silver_bec_ods.MSC_SAFETY_STOCKS (
  plan_id,
  organization_id,
  sr_instance_id,
  inventory_item_id,
  period_start_date,
  safety_stock_quantity,
  updated,
  status,
  refresh_number,
  last_update_date,
  last_updated_by,
  creation_date,
  created_by,
  last_update_login,
  request_id,
  program_id,
  program_update_date,
  program_application_id,
  target_safety_stock,
  project_id,
  task_id,
  planning_group,
  user_defined_safety_stocks,
  user_defined_dos,
  target_days_of_supply,
  achieved_days_of_supply,
  unit_number,
  demand_var_ss_percent,
  mfg_ltvar_ss_percent,
  transit_ltvar_ss_percent,
  sup_ltvar_ss_percent,
  total_unpooled_safety_stock,
  item_type_id,
  item_type_value,
  new_plan_id,
  simulation_set_id,
  new_plan_list,
  applied,
  reserved_safety_stock_qty,
  inventory_level,
  kca_operation,
  is_deleted_flg,
  kca_seq_id,
  kca_seq_date
)
SELECT
  plan_id,
  organization_id,
  sr_instance_id,
  inventory_item_id,
  period_start_date,
  safety_stock_quantity,
  updated,
  status,
  refresh_number,
  last_update_date,
  last_updated_by,
  creation_date,
  created_by,
  last_update_login,
  request_id,
  program_id,
  program_update_date,
  program_application_id,
  target_safety_stock,
  project_id,
  task_id,
  planning_group,
  user_defined_safety_stocks,
  user_defined_dos,
  target_days_of_supply,
  achieved_days_of_supply,
  unit_number,
  demand_var_ss_percent,
  mfg_ltvar_ss_percent,
  transit_ltvar_ss_percent,
  sup_ltvar_ss_percent,
  total_unpooled_safety_stock,
  item_type_id,
  item_type_value,
  new_plan_id,
  simulation_set_id,
  new_plan_list,
  applied,
  reserved_safety_stock_qty,
  inventory_level,
  kca_operation,
  'N' AS IS_DELETED_FLG,
  CAST(NULLIF(KCA_SEQ_ID, '') AS DECIMAL(36, 0)) AS KCA_SEQ_ID,
  kca_seq_date
FROM bronze_bec_ods_stg.MSC_SAFETY_STOCKS;
UPDATE bec_etl_ctrl.batch_ods_info SET load_type = 'I', last_refresh_date = CURRENT_TIMESTAMP()
WHERE
  ods_table_name = 'msc_safety_stocks';
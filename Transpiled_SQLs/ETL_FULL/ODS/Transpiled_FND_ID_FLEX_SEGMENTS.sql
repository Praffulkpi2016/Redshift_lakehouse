DROP table IF EXISTS silver_bec_ods.FND_ID_FLEX_SEGMENTS;
CREATE TABLE IF NOT EXISTS silver_bec_ods.FND_ID_FLEX_SEGMENTS (
  APPLICATION_ID DECIMAL(10, 0),
  ID_FLEX_CODE STRING,
  ID_FLEX_NUM DECIMAL(15, 0),
  APPLICATION_COLUMN_NAME STRING,
  SEGMENT_NAME STRING,
  LAST_UPDATE_DATE TIMESTAMP,
  LAST_UPDATED_BY DECIMAL(15, 0),
  CREATION_DATE TIMESTAMP,
  CREATED_BY DECIMAL(15, 0),
  LAST_UPDATE_LOGIN DECIMAL(15, 0),
  SEGMENT_NUM DECIMAL(3, 0),
  APPLICATION_COLUMN_INDEX_FLAG STRING,
  ENABLED_FLAG STRING,
  REQUIRED_FLAG STRING,
  DISPLAY_FLAG STRING,
  DISPLAY_SIZE DECIMAL(3, 0),
  SECURITY_ENABLED_FLAG STRING,
  MAXIMUM_DESCRIPTION_LEN DECIMAL(3, 0),
  CONCATENATION_DESCRIPTION_LEN DECIMAL(3, 0),
  FLEX_VALUE_SET_ID DECIMAL(10, 0),
  RANGE_CODE STRING,
  DEFAULT_TYPE STRING,
  DEFAULT_VALUE STRING,
  RUNTIME_PROPERTY_FUNCTION STRING,
  SECURITY_GROUP_ID DECIMAL(15, 0),
  ADDITIONAL_WHERE_CLAUSE STRING,
  SEGMENT_INSERT_FLAG STRING,
  SEGMENT_UPDATE_FLAG STRING,
  ZD_EDITION_NAME STRING,
  ZD_SYNC STRING,
  KCA_OPERATION STRING,
  IS_DELETED_FLG STRING,
  kca_seq_id DECIMAL(36, 0),
  kca_seq_date TIMESTAMP
);
INSERT INTO silver_bec_ods.FND_ID_FLEX_SEGMENTS (
  APPLICATION_ID,
  ID_FLEX_CODE,
  ID_FLEX_NUM,
  APPLICATION_COLUMN_NAME,
  SEGMENT_NAME,
  LAST_UPDATE_DATE,
  LAST_UPDATED_BY,
  CREATION_DATE,
  CREATED_BY,
  LAST_UPDATE_LOGIN,
  SEGMENT_NUM,
  APPLICATION_COLUMN_INDEX_FLAG,
  ENABLED_FLAG,
  REQUIRED_FLAG,
  DISPLAY_FLAG,
  DISPLAY_SIZE,
  SECURITY_ENABLED_FLAG,
  MAXIMUM_DESCRIPTION_LEN,
  CONCATENATION_DESCRIPTION_LEN,
  FLEX_VALUE_SET_ID,
  RANGE_CODE,
  DEFAULT_TYPE,
  DEFAULT_VALUE,
  RUNTIME_PROPERTY_FUNCTION,
  ADDITIONAL_WHERE_CLAUSE,
  SEGMENT_INSERT_FLAG,
  SEGMENT_UPDATE_FLAG,
  ZD_EDITION_NAME,
  ZD_SYNC,
  KCA_OPERATION,
  IS_DELETED_FLG,
  kca_seq_id,
  kca_seq_date
)
(
  SELECT
    APPLICATION_ID,
    ID_FLEX_CODE,
    ID_FLEX_NUM,
    APPLICATION_COLUMN_NAME,
    SEGMENT_NAME,
    LAST_UPDATE_DATE,
    LAST_UPDATED_BY,
    CREATION_DATE,
    CREATED_BY,
    LAST_UPDATE_LOGIN,
    SEGMENT_NUM,
    APPLICATION_COLUMN_INDEX_FLAG,
    ENABLED_FLAG,
    REQUIRED_FLAG,
    DISPLAY_FLAG,
    DISPLAY_SIZE,
    SECURITY_ENABLED_FLAG,
    MAXIMUM_DESCRIPTION_LEN,
    CONCATENATION_DESCRIPTION_LEN,
    FLEX_VALUE_SET_ID,
    RANGE_CODE,
    DEFAULT_TYPE,
    DEFAULT_VALUE,
    RUNTIME_PROPERTY_FUNCTION,
    ADDITIONAL_WHERE_CLAUSE,
    SEGMENT_INSERT_FLAG,
    SEGMENT_UPDATE_FLAG,
    ZD_EDITION_NAME,
    ZD_SYNC,
    KCA_OPERATION,
    'N' AS IS_DELETED_FLG,
    CAST(NULLIF(KCA_SEQ_ID, '') AS DECIMAL(36, 0)) AS KCA_SEQ_ID,
    kca_seq_date
  FROM bronze_bec_ods_stg.FND_ID_FLEX_SEGMENTS
);
UPDATE bec_etl_ctrl.batch_ods_info SET load_type = 'I', last_refresh_date = CURRENT_TIMESTAMP()
WHERE
  ods_table_name = 'fnd_id_flex_segments';
DROP TABLE IF EXISTS silver_bec_ods.IBY_EXT_BANK_ACCOUNTS;
CREATE TABLE IF NOT EXISTS silver_bec_ods.IBY_EXT_BANK_ACCOUNTS (
  ext_bank_account_id DECIMAL(15, 0),
  country_code STRING,
  branch_id DECIMAL(15, 0),
  bank_id DECIMAL(15, 0),
  bank_account_num STRING,
  masked_bank_account_num STRING,
  ba_mask_setting STRING,
  ba_unmask_length DECIMAL(2),
  currency_code STRING,
  iban STRING,
  iban_hash1 STRING,
  iban_hash2 STRING,
  masked_iban STRING,
  check_digits STRING,
  bank_account_type STRING,
  account_classification STRING,
  account_suffix STRING,
  agency_location_code STRING,
  payment_factor_flag STRING,
  foreign_payment_use_flag STRING,
  exchange_rate_agreement_num STRING,
  exchange_rate_agreement_type STRING,
  exchange_rate DECIMAL(28, 10),
  hedging_contract_reference STRING,
  secondary_account_reference STRING,
  ba_num_sec_segment_id DECIMAL(15, 0),
  `encrypted` STRING,
  iban_sec_segment_id DECIMAL(15, 0),
  attribute_category STRING,
  attribute1 STRING,
  attribute2 STRING,
  attribute3 STRING,
  attribute4 STRING,
  attribute5 STRING,
  attribute6 STRING,
  attribute7 STRING,
  attribute8 STRING,
  attribute9 STRING,
  attribute10 STRING,
  attribute11 STRING,
  attribute12 STRING,
  attribute13 STRING,
  attribute14 STRING,
  attribute15 STRING,
  request_id DECIMAL(15, 0),
  program_application_id DECIMAL(15, 0),
  program_id DECIMAL(15, 0),
  program_update_date TIMESTAMP,
  start_date TIMESTAMP,
  end_date TIMESTAMP,
  created_by DECIMAL(15, 0),
  creation_date TIMESTAMP,
  last_updated_by DECIMAL(15, 0),
  last_update_date TIMESTAMP,
  last_update_login DECIMAL(15, 0),
  object_version_number DECIMAL(28, 10),
  bank_account_name STRING,
  bank_account_name_alt STRING,
  short_acct_name STRING,
  description STRING,
  bank_account_num_electronic STRING,
  ba_num_elec_sec_segment_id DECIMAL(15, 0),
  salt_version DECIMAL(2),
  contact_name STRING,
  contact_phone STRING,
  contact_fax STRING,
  contact_email STRING,
  KCA_OPERATION STRING,
  IS_DELETED_FLG STRING,
  kca_seq_id DECIMAL(36, 0),
  kca_seq_date TIMESTAMP
);
INSERT INTO silver_bec_ods.IBY_EXT_BANK_ACCOUNTS (
  EXT_BANK_ACCOUNT_ID,
  COUNTRY_CODE,
  BRANCH_ID,
  BANK_ID,
  BANK_ACCOUNT_NUM, /* ,      BANK_ACCOUNT_NUM_HASH1 */ /* ,      BANK_ACCOUNT_NUM_HASH2 */
  MASKED_BANK_ACCOUNT_NUM,
  BA_MASK_SETTING,
  BA_UNMASK_LENGTH,
  CURRENCY_CODE,
  IBAN,
  IBAN_HASH1,
  IBAN_HASH2,
  MASKED_IBAN,
  CHECK_DIGITS,
  BANK_ACCOUNT_TYPE,
  ACCOUNT_CLASSIFICATION,
  ACCOUNT_SUFFIX,
  AGENCY_LOCATION_CODE,
  PAYMENT_FACTOR_FLAG,
  FOREIGN_PAYMENT_USE_FLAG,
  EXCHANGE_RATE_AGREEMENT_NUM,
  EXCHANGE_RATE_AGREEMENT_TYPE,
  EXCHANGE_RATE,
  HEDGING_CONTRACT_REFERENCE,
  SECONDARY_ACCOUNT_REFERENCE,
  BA_NUM_SEC_SEGMENT_ID,
  ENCRYPTED,
  IBAN_SEC_SEGMENT_ID,
  ATTRIBUTE_CATEGORY,
  ATTRIBUTE1,
  ATTRIBUTE2,
  ATTRIBUTE3,
  ATTRIBUTE4,
  ATTRIBUTE5,
  ATTRIBUTE6,
  ATTRIBUTE7,
  ATTRIBUTE8,
  ATTRIBUTE9,
  ATTRIBUTE10,
  ATTRIBUTE11,
  ATTRIBUTE12,
  ATTRIBUTE13,
  ATTRIBUTE14,
  ATTRIBUTE15,
  REQUEST_ID,
  PROGRAM_APPLICATION_ID,
  PROGRAM_ID,
  PROGRAM_UPDATE_DATE,
  START_DATE,
  END_DATE,
  CREATED_BY,
  CREATION_DATE,
  LAST_UPDATED_BY,
  LAST_UPDATE_DATE,
  LAST_UPDATE_LOGIN,
  OBJECT_VERSION_NUMBER,
  BANK_ACCOUNT_NAME,
  BANK_ACCOUNT_NAME_ALT,
  SHORT_ACCT_NAME,
  DESCRIPTION,
  BANK_ACCOUNT_NUM_ELECTRONIC,
  BA_NUM_ELEC_SEC_SEGMENT_ID,
  SALT_VERSION,
  CONTACT_NAME,
  CONTACT_PHONE,
  CONTACT_FAX,
  CONTACT_EMAIL,
  kca_operation,
  IS_DELETED_FLG,
  kca_seq_id,
  kca_seq_date
)
SELECT
  EXT_BANK_ACCOUNT_ID,
  COUNTRY_CODE,
  BRANCH_ID,
  BANK_ID,
  BANK_ACCOUNT_NUM, /* ,      BANK_ACCOUNT_NUM_HASH1 */ /* ,      BANK_ACCOUNT_NUM_HASH2 */
  MASKED_BANK_ACCOUNT_NUM,
  BA_MASK_SETTING,
  BA_UNMASK_LENGTH,
  CURRENCY_CODE,
  IBAN,
  IBAN_HASH1,
  IBAN_HASH2,
  MASKED_IBAN,
  CHECK_DIGITS,
  BANK_ACCOUNT_TYPE,
  ACCOUNT_CLASSIFICATION,
  ACCOUNT_SUFFIX,
  AGENCY_LOCATION_CODE,
  PAYMENT_FACTOR_FLAG,
  FOREIGN_PAYMENT_USE_FLAG,
  EXCHANGE_RATE_AGREEMENT_NUM,
  EXCHANGE_RATE_AGREEMENT_TYPE,
  EXCHANGE_RATE,
  HEDGING_CONTRACT_REFERENCE,
  SECONDARY_ACCOUNT_REFERENCE,
  BA_NUM_SEC_SEGMENT_ID,
  ENCRYPTED,
  IBAN_SEC_SEGMENT_ID,
  ATTRIBUTE_CATEGORY,
  ATTRIBUTE1,
  ATTRIBUTE2,
  ATTRIBUTE3,
  ATTRIBUTE4,
  ATTRIBUTE5,
  ATTRIBUTE6,
  ATTRIBUTE7,
  ATTRIBUTE8,
  ATTRIBUTE9,
  ATTRIBUTE10,
  ATTRIBUTE11,
  ATTRIBUTE12,
  ATTRIBUTE13,
  ATTRIBUTE14,
  ATTRIBUTE15,
  REQUEST_ID,
  PROGRAM_APPLICATION_ID,
  PROGRAM_ID,
  PROGRAM_UPDATE_DATE,
  START_DATE,
  END_DATE,
  CREATED_BY,
  CREATION_DATE,
  LAST_UPDATED_BY,
  LAST_UPDATE_DATE,
  LAST_UPDATE_LOGIN,
  OBJECT_VERSION_NUMBER,
  BANK_ACCOUNT_NAME,
  BANK_ACCOUNT_NAME_ALT,
  SHORT_ACCT_NAME,
  DESCRIPTION,
  BANK_ACCOUNT_NUM_ELECTRONIC,
  BA_NUM_ELEC_SEC_SEGMENT_ID,
  SALT_VERSION,
  CONTACT_NAME,
  CONTACT_PHONE,
  CONTACT_FAX,
  CONTACT_EMAIL,
  KCA_OPERATION,
  'N' AS IS_DELETED_FLG,
  CAST(NULLIF(KCA_SEQ_ID, '') AS DECIMAL(36, 0)) AS KCA_SEQ_ID,
  kca_seq_date
FROM bronze_bec_ods_stg.IBY_EXT_BANK_ACCOUNTS;
UPDATE bec_etl_ctrl.batch_ods_info SET load_type = 'I', last_refresh_date = CURRENT_TIMESTAMP()
WHERE
  ods_table_name = 'iby_ext_bank_accounts';
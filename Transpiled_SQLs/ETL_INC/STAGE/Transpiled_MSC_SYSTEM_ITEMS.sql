TRUNCATE table bronze_bec_ods_stg.msc_system_items;
INSERT INTO bronze_bec_ods_stg.msc_system_items (
  PLAN_ID,
  ORGANIZATION_ID,
  INVENTORY_ITEM_ID,
  SR_INSTANCE_ID,
  SR_INVENTORY_ITEM_ID,
  ITEM_NAME,
  LOTS_EXPIRATION,
  LOT_CONTROL_CODE,
  SHRINKAGE_RATE,
  FIXED_DAYS_SUPPLY,
  FIXED_ORDER_QUANTITY,
  FIXED_LOT_MULTIPLIER,
  MINIMUM_ORDER_QUANTITY,
  MAXIMUM_ORDER_QUANTITY,
  ROUNDING_CONTROL_TYPE,
  PLANNING_TIME_FENCE_DAYS,
  PLANNING_TIME_FENCE_DATE,
  DEMAND_TIME_FENCE_DAYS,
  DEMAND_TIME_FENCE_DATE,
  DESCRIPTION,
  RELEASE_TIME_FENCE_CODE,
  RELEASE_TIME_FENCE_DAYS,
  IN_SOURCE_PLAN,
  REVISION,
  SR_CATEGORY_ID,
  ABC_CLASS,
  CATEGORY_NAME,
  MRP_PLANNING_CODE,
  FIXED_LEAD_TIME,
  VARIABLE_LEAD_TIME,
  PREPROCESSING_LEAD_TIME,
  POSTPROCESSING_LEAD_TIME,
  FULL_LEAD_TIME,
  CUMULATIVE_TOTAL_LEAD_TIME,
  CUM_MANUFACTURING_LEAD_TIME,
  UOM_CODE,
  UNIT_WEIGHT,
  UNIT_VOLUME,
  WEIGHT_UOM,
  VOLUME_UOM,
  PRODUCT_FAMILY_ID,
  ATP_RULE_ID,
  ATP_COMPONENTS_FLAG,
  BUILD_IN_WIP_FLAG,
  PURCHASING_ENABLED_FLAG,
  PLANNING_MAKE_BUY_CODE,
  REPETITIVE_TYPE,
  REPETITIVE_VARIANCE,
  STANDARD_COST,
  CARRYING_COST,
  ORDER_COST,
  MATERIAL_COST,
  DMD_LATENESS_COST,
  RESOURCE_COST,
  SS_PENALTY_COST,
  SUPPLIER_CAP_OVERUTIL_COST,
  LIST_PRICE,
  AVERAGE_DISCOUNT,
  ENGINEERING_ITEM_FLAG,
  WIP_SUPPLY_TYPE,
  SAFETY_STOCK_CODE,
  SAFETY_STOCK_PERCENT,
  SAFETY_STOCK_BUCKET_DAYS,
  INVENTORY_USE_UP_DATE,
  BUYER_NAME,
  PLANNER_CODE,
  PLANNING_EXCEPTION_SET,
  EXCESS_QUANTITY,
  EXCEPTION_SHORTAGE_DAYS,
  EXCEPTION_EXCESS_DAYS,
  EXCEPTION_OVERPROMISED_DAYS,
  EXCEPTION_CODE,
  BOM_ITEM_TYPE,
  ATO_FORECAST_CONTROL,
  EFFECTIVITY_CONTROL,
  ORGANIZATION_CODE,
  ACCEPTABLE_RATE_INCREASE,
  ACCEPTABLE_RATE_DECREASE,
  EXCEPTION_REP_VARIANCE_DAYS,
  OVERRUN_PERCENTAGE,
  INVENTORY_PLANNING_CODE,
  ACCEPTABLE_EARLY_DELIVERY,
  CALCULATE_ATP,
  END_ASSEMBLY_PEGGING_FLAG,
  END_ASSEMBLY_PEGGING,
  FULL_PEGGING,
  INVENTORY_ITEM_FLAG,
  SOURCE_ORG_ID,
  BASE_ITEM_ID,
  ABC_CLASS_NAME,
  FIXED_SAFETY_STOCK_QTY,
  PRIMARY_SUPPLIER_ID,
  ATP_FLAG,
  LOW_LEVEL_CODE,
  PLANNER_STATUS_CODE,
  NETTABLE_INVENTORY_QUANTITY,
  NONNETTABLE_INVENTORY_QUANTITY,
  REFRESH_NUMBER,
  LAST_UPDATE_DATE,
  LAST_UPDATED_BY,
  CREATION_DATE,
  CREATED_BY,
  LAST_UPDATE_LOGIN,
  REQUEST_ID,
  PROGRAM_APPLICATION_ID,
  PROGRAM_ID,
  PROGRAM_UPDATE_DATE,
  ATTRIBUTE_CATEGORY,
  ATTRIBUTE1,
  ATTRIBUTE2,
  ATTRIBUTE3,
  ATTRIBUTE4,
  ATTRIBUTE5,
  ATTRIBUTE6,
  ATTRIBUTE7,
  ATTRIBUTE8,
  ATTRIBUTE9,
  ATTRIBUTE10,
  ATTRIBUTE11,
  ATTRIBUTE12,
  ATTRIBUTE13,
  ATTRIBUTE14,
  ATTRIBUTE15,
  REVISION_QTY_CONTROL_CODE,
  EXPENSE_ACCOUNT,
  INVENTORY_ASSET_FLAG,
  BUYER_ID,
  REPETITIVE_PLANNING_FLAG,
  PICK_COMPONENTS_FLAG,
  SERVICE_LEVEL,
  REPLENISH_TO_ORDER_FLAG,
  PIP_FLAG,
  YIELD_CONV_FACTOR,
  MIN_MINMAX_QUANTITY,
  MAX_MINMAX_QUANTITY,
  NEW_ATP_FLAG,
  SOURCE_TYPE,
  SUBSTITUTION_WINDOW,
  CREATE_SUPPLY_FLAG,
  REORDER_POINT,
  AVERAGE_ANNUAL_DEMAND,
  ECONOMIC_ORDER_QUANTITY,
  SERIAL_NUMBER_CONTROL_CODE,
  CONVERGENCE,
  DIVERGENCE,
  CONTINOUS_TRANSFER,
  CRITICAL_COMPONENT_FLAG,
  REDUCE_MPS,
  CONSIGNED_FLAG,
  VMI_MINIMUM_UNITS,
  VMI_MINIMUM_DAYS,
  VMI_MAXIMUM_UNITS,
  VMI_MAXIMUM_DAYS,
  AVERAGE_DAILY_DEMAND,
  VMI_FIXED_ORDER_QUANTITY,
  SO_AUTHORIZATION_FLAG,
  VMI_FORECAST_TYPE,
  FORECAST_HORIZON,
  ASN_AUTOEXPIRE_FLAG,
  VMI_REFRESH_FLAG,
  BUDGET_CONSTRAINED,
  MAX_QUANTITY,
  MAX_QUANTITY_DOS,
  DAYS_TGT_INV_WINDOW,
  DAYS_MAX_INV_WINDOW,
  DAYS_TGT_INV_SUPPLY,
  DAYS_MAX_INV_SUPPLY,
  DRP_PLANNED,
  AGGREGATE_TIME_FENCE_DATE,
  INFERRED_CRITICAL_FLAG,
  SS_WINDOW_SIZE,
  LOWEST_LEVEL_SRC,
  EAM_ITEM_TYPE,
  LOTS_EXIST,
  LEADTIME_VARIABILITY,
  MIN_SHELF_LIFE_DAYS,
  GROUP_ID,
  REPAIR_YIELD,
  REPAIR_PROGRAM,
  REPAIR_LEAD_TIME,
  PRE_POSITION_INVENTORY,
  PREPOSITION_POINT,
  REPAIR_LEADTIME,
  DEMAND_FULFILLMENT_LT,
  ITEM_CREATION_DATE,
  SHORTAGE_TYPE,
  EXCESS_TYPE,
  PLANNING_TIME_FENCE_CODE,
  PEGGING_DEMAND_WINDOW_DAYS,
  PEGGING_SUPPLY_WINDOW_DAYS,
  FORECAST_RULE_FOR_DEMANDS,
  FORECAST_RULE_FOR_RETURNS,
  DEMAND_DISTRIBUTION,
  INTERARRIVAL_TIME,
  END_OF_LIFE_DATE,
  STD_DMD_OVER_HORIZON,
  LIFE_TIME_BUY_DATE,
  REPAIR_COST,
  CRITICALITY_CATEGORY,
  AVG_DEMAND_BEYOND_PH,
  AVG_RETURNS_BEYOND_PH,
  RETURN_FORECAST_TIME_FENCE,
  DEFECTIVE_ITEM_COST,
  STD_DEVIATION_FOR_DEMAND,
  MEAN_INTER_ARRIVAL,
  STD_DEVIATION_INTER_ARRIVAL,
  INTERARRIVAL_DIST_METHOD,
  BASIS_AVG_DAILY_DEMAND,
  COEFFICIENT_OF_VARIATION,
  STANDARD_DEVIATION,
  LAST_REPLAN_DATE,
  NETCHANGE_REPLAN_FLAG,
  REPLAN_PERIOD,
  SAFETY_LEAD_TIME,
  UNSATISFIED_DEMAND_FACTOR,
  MAX_USAGE_FACTOR,
  MIN_SUP_DEM_PERCENT,
  DMD_SATISFIED_PERCENT,
  NEW_PLAN_ID,
  NEW_PLAN_LIST,
  SIMULATION_SET_ID,
  NO_PL_ORD_BEFORE_WIP_WIN,
  PLANNING_UNITS_OF_WORK,
  EXCESS_HORIZON,
  OBSOLESCENCE_DATE,
  COMPUTE_EOQ,
  COMPUTE_SS,
  ROP_SAFETY_STOCK,
  CONSIDER_IN_CTB_FLAG,
  CALCULATE_CTB_FLAG,
  CTB_KPI_HORIZON,
  APPLIED,
  INTERMITTENT_DEMAND,
  COMP_SUBSTITUTION_FLAG,
  CONSUME_BEF_PRIMARY_FLAG,
  REPAIR_MODULE,
  SCRAP_RATE,
  REBUILD_ACTIVITY,
  IS_MODIFIED,
  ORDER_PERIOD,
  INV_DAYS_INCREMENT,
  AVERAGE_CYCLE_STOCK,
  ADS_CALC_DAYS,
  SAFETY_STOCK_MRSL,
  MRSL_INGREDIENT,
  MRSL_INGREDIENT_ID,
  ANNUAL_SALES_QTY,
  ANNUAL_SALES_COUNT,
  ANNUAL_SALES_VALUE,
  ANNUAL_SHIP_QTY,
  ANNUAL_SHIP_COUNT,
  ANNUAL_SHIP_VALUE,
  DEMAND_VARIANCE,
  INVENTORY_POLICY,
  POLICY_UOM,
  MIN_UNITS,
  MAX_UNITS,
  MIN_DAYS,
  MAX_DAYS,
  ANNUAL_ORDER_CNT,
  ORDER_CYCLE_CAL,
  FCST_ERROR,
  KCA_OPERATION,
  kca_seq_id,
  kca_seq_date
)
(
  SELECT
    PLAN_ID,
    ORGANIZATION_ID,
    INVENTORY_ITEM_ID,
    SR_INSTANCE_ID,
    SR_INVENTORY_ITEM_ID,
    ITEM_NAME,
    LOTS_EXPIRATION,
    LOT_CONTROL_CODE,
    SHRINKAGE_RATE,
    FIXED_DAYS_SUPPLY,
    FIXED_ORDER_QUANTITY,
    FIXED_LOT_MULTIPLIER,
    MINIMUM_ORDER_QUANTITY,
    MAXIMUM_ORDER_QUANTITY,
    ROUNDING_CONTROL_TYPE,
    PLANNING_TIME_FENCE_DAYS,
    PLANNING_TIME_FENCE_DATE,
    DEMAND_TIME_FENCE_DAYS,
    DEMAND_TIME_FENCE_DATE,
    DESCRIPTION,
    RELEASE_TIME_FENCE_CODE,
    RELEASE_TIME_FENCE_DAYS,
    IN_SOURCE_PLAN,
    REVISION,
    SR_CATEGORY_ID,
    ABC_CLASS,
    CATEGORY_NAME,
    MRP_PLANNING_CODE,
    FIXED_LEAD_TIME,
    VARIABLE_LEAD_TIME,
    PREPROCESSING_LEAD_TIME,
    POSTPROCESSING_LEAD_TIME,
    FULL_LEAD_TIME,
    CUMULATIVE_TOTAL_LEAD_TIME,
    CUM_MANUFACTURING_LEAD_TIME,
    UOM_CODE,
    UNIT_WEIGHT,
    UNIT_VOLUME,
    WEIGHT_UOM,
    VOLUME_UOM,
    PRODUCT_FAMILY_ID,
    ATP_RULE_ID,
    ATP_COMPONENTS_FLAG,
    BUILD_IN_WIP_FLAG,
    PURCHASING_ENABLED_FLAG,
    PLANNING_MAKE_BUY_CODE,
    REPETITIVE_TYPE,
    REPETITIVE_VARIANCE,
    STANDARD_COST,
    CARRYING_COST,
    ORDER_COST,
    MATERIAL_COST,
    DMD_LATENESS_COST,
    RESOURCE_COST,
    SS_PENALTY_COST,
    SUPPLIER_CAP_OVERUTIL_COST,
    LIST_PRICE,
    AVERAGE_DISCOUNT,
    ENGINEERING_ITEM_FLAG,
    WIP_SUPPLY_TYPE,
    SAFETY_STOCK_CODE,
    SAFETY_STOCK_PERCENT,
    SAFETY_STOCK_BUCKET_DAYS,
    INVENTORY_USE_UP_DATE,
    BUYER_NAME,
    PLANNER_CODE,
    PLANNING_EXCEPTION_SET,
    EXCESS_QUANTITY,
    EXCEPTION_SHORTAGE_DAYS,
    EXCEPTION_EXCESS_DAYS,
    EXCEPTION_OVERPROMISED_DAYS,
    EXCEPTION_CODE,
    BOM_ITEM_TYPE,
    ATO_FORECAST_CONTROL,
    EFFECTIVITY_CONTROL,
    ORGANIZATION_CODE,
    ACCEPTABLE_RATE_INCREASE,
    ACCEPTABLE_RATE_DECREASE,
    EXCEPTION_REP_VARIANCE_DAYS,
    OVERRUN_PERCENTAGE,
    INVENTORY_PLANNING_CODE,
    ACCEPTABLE_EARLY_DELIVERY,
    CALCULATE_ATP,
    END_ASSEMBLY_PEGGING_FLAG,
    END_ASSEMBLY_PEGGING,
    FULL_PEGGING,
    INVENTORY_ITEM_FLAG,
    SOURCE_ORG_ID,
    BASE_ITEM_ID,
    ABC_CLASS_NAME,
    FIXED_SAFETY_STOCK_QTY,
    PRIMARY_SUPPLIER_ID,
    ATP_FLAG,
    LOW_LEVEL_CODE,
    PLANNER_STATUS_CODE,
    NETTABLE_INVENTORY_QUANTITY,
    NONNETTABLE_INVENTORY_QUANTITY,
    REFRESH_NUMBER,
    LAST_UPDATE_DATE,
    LAST_UPDATED_BY,
    CREATION_DATE,
    CREATED_BY,
    LAST_UPDATE_LOGIN,
    REQUEST_ID,
    PROGRAM_APPLICATION_ID,
    PROGRAM_ID,
    PROGRAM_UPDATE_DATE,
    ATTRIBUTE_CATEGORY,
    ATTRIBUTE1,
    ATTRIBUTE2,
    ATTRIBUTE3,
    ATTRIBUTE4,
    ATTRIBUTE5,
    ATTRIBUTE6,
    ATTRIBUTE7,
    ATTRIBUTE8,
    ATTRIBUTE9,
    ATTRIBUTE10,
    ATTRIBUTE11,
    ATTRIBUTE12,
    ATTRIBUTE13,
    ATTRIBUTE14,
    ATTRIBUTE15,
    REVISION_QTY_CONTROL_CODE,
    EXPENSE_ACCOUNT,
    INVENTORY_ASSET_FLAG,
    BUYER_ID,
    REPETITIVE_PLANNING_FLAG,
    PICK_COMPONENTS_FLAG,
    SERVICE_LEVEL,
    REPLENISH_TO_ORDER_FLAG,
    PIP_FLAG,
    YIELD_CONV_FACTOR,
    MIN_MINMAX_QUANTITY,
    MAX_MINMAX_QUANTITY,
    NEW_ATP_FLAG,
    SOURCE_TYPE,
    SUBSTITUTION_WINDOW,
    CREATE_SUPPLY_FLAG,
    REORDER_POINT,
    AVERAGE_ANNUAL_DEMAND,
    ECONOMIC_ORDER_QUANTITY,
    SERIAL_NUMBER_CONTROL_CODE,
    CONVERGENCE,
    DIVERGENCE,
    CONTINOUS_TRANSFER,
    CRITICAL_COMPONENT_FLAG,
    REDUCE_MPS,
    CONSIGNED_FLAG,
    VMI_MINIMUM_UNITS,
    VMI_MINIMUM_DAYS,
    VMI_MAXIMUM_UNITS,
    VMI_MAXIMUM_DAYS,
    AVERAGE_DAILY_DEMAND,
    VMI_FIXED_ORDER_QUANTITY,
    SO_AUTHORIZATION_FLAG,
    VMI_FORECAST_TYPE,
    FORECAST_HORIZON,
    ASN_AUTOEXPIRE_FLAG,
    VMI_REFRESH_FLAG,
    BUDGET_CONSTRAINED,
    MAX_QUANTITY,
    MAX_QUANTITY_DOS,
    DAYS_TGT_INV_WINDOW,
    DAYS_MAX_INV_WINDOW,
    DAYS_TGT_INV_SUPPLY,
    DAYS_MAX_INV_SUPPLY,
    DRP_PLANNED,
    AGGREGATE_TIME_FENCE_DATE,
    INFERRED_CRITICAL_FLAG,
    SS_WINDOW_SIZE,
    LOWEST_LEVEL_SRC,
    EAM_ITEM_TYPE,
    LOTS_EXIST,
    LEADTIME_VARIABILITY,
    MIN_SHELF_LIFE_DAYS,
    GROUP_ID,
    REPAIR_YIELD,
    REPAIR_PROGRAM,
    REPAIR_LEAD_TIME,
    PRE_POSITION_INVENTORY,
    PREPOSITION_POINT,
    REPAIR_LEADTIME,
    DEMAND_FULFILLMENT_LT,
    ITEM_CREATION_DATE,
    SHORTAGE_TYPE,
    EXCESS_TYPE,
    PLANNING_TIME_FENCE_CODE,
    PEGGING_DEMAND_WINDOW_DAYS,
    PEGGING_SUPPLY_WINDOW_DAYS,
    FORECAST_RULE_FOR_DEMANDS,
    FORECAST_RULE_FOR_RETURNS,
    DEMAND_DISTRIBUTION,
    INTERARRIVAL_TIME,
    END_OF_LIFE_DATE,
    STD_DMD_OVER_HORIZON,
    LIFE_TIME_BUY_DATE,
    REPAIR_COST,
    CRITICALITY_CATEGORY,
    AVG_DEMAND_BEYOND_PH,
    AVG_RETURNS_BEYOND_PH,
    RETURN_FORECAST_TIME_FENCE,
    DEFECTIVE_ITEM_COST,
    STD_DEVIATION_FOR_DEMAND,
    MEAN_INTER_ARRIVAL,
    STD_DEVIATION_INTER_ARRIVAL,
    INTERARRIVAL_DIST_METHOD,
    BASIS_AVG_DAILY_DEMAND,
    COEFFICIENT_OF_VARIATION,
    STANDARD_DEVIATION,
    LAST_REPLAN_DATE,
    NETCHANGE_REPLAN_FLAG,
    REPLAN_PERIOD,
    SAFETY_LEAD_TIME,
    UNSATISFIED_DEMAND_FACTOR,
    MAX_USAGE_FACTOR,
    MIN_SUP_DEM_PERCENT,
    DMD_SATISFIED_PERCENT,
    NEW_PLAN_ID,
    NEW_PLAN_LIST,
    SIMULATION_SET_ID,
    NO_PL_ORD_BEFORE_WIP_WIN,
    PLANNING_UNITS_OF_WORK,
    EXCESS_HORIZON,
    OBSOLESCENCE_DATE,
    COMPUTE_EOQ,
    COMPUTE_SS,
    ROP_SAFETY_STOCK,
    CONSIDER_IN_CTB_FLAG,
    CALCULATE_CTB_FLAG,
    CTB_KPI_HORIZON,
    APPLIED,
    INTERMITTENT_DEMAND,
    COMP_SUBSTITUTION_FLAG,
    CONSUME_BEF_PRIMARY_FLAG,
    REPAIR_MODULE,
    SCRAP_RATE,
    REBUILD_ACTIVITY,
    IS_MODIFIED,
    ORDER_PERIOD,
    INV_DAYS_INCREMENT,
    AVERAGE_CYCLE_STOCK,
    ADS_CALC_DAYS,
    SAFETY_STOCK_MRSL,
    MRSL_INGREDIENT,
    MRSL_INGREDIENT_ID,
    ANNUAL_SALES_QTY,
    ANNUAL_SALES_COUNT,
    ANNUAL_SALES_VALUE,
    ANNUAL_SHIP_QTY,
    ANNUAL_SHIP_COUNT,
    ANNUAL_SHIP_VALUE,
    DEMAND_VARIANCE,
    INVENTORY_POLICY,
    POLICY_UOM,
    MIN_UNITS,
    MAX_UNITS,
    MIN_DAYS,
    MAX_DAYS,
    ANNUAL_ORDER_CNT,
    ORDER_CYCLE_CAL,
    FCST_ERROR,
    KCA_OPERATION,
    kca_seq_id,
    kca_seq_date
  FROM bec_raw_dl_ext.msc_system_items
  WHERE
    kca_operation <> 'DELETE'
    AND COALESCE(kca_seq_id, '') <> ''
    AND (SR_INSTANCE_ID, PLAN_ID, INVENTORY_ITEM_ID, ORGANIZATION_ID, kca_seq_id) IN (
      SELECT
        SR_INSTANCE_ID,
        PLAN_ID,
        INVENTORY_ITEM_ID,
        ORGANIZATION_ID,
        MAX(kca_seq_id)
      FROM bec_raw_dl_ext.msc_system_items
      WHERE
        kca_operation <> 'DELETE' AND COALESCE(kca_seq_id, '') <> ''
      GROUP BY
        SR_INSTANCE_ID,
        PLAN_ID,
        INVENTORY_ITEM_ID,
        ORGANIZATION_ID
    )
    AND (
      kca_seq_date > (
        SELECT
          (
            executebegints - prune_days
          )
        FROM bec_etl_ctrl.batch_ods_info
        WHERE
          ods_table_name = 'msc_system_items'
      )
    )
);
/*
# Copyright(c) 2022 KPI Partners, Inc. All Rights Reserved.
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#
# author: KPI Partners, Inc.
# version: 2022.06
# description: This script represents Incremental load approach for stage.
# File Version: KPI v1.0
*/
begin;

truncate table bec_ods_stg.MTL_SERIAL_NUMBERS;

insert into	bec_ods_stg.MTL_SERIAL_NUMBERS
   (
	inventory_item_id,
	serial_number,
	last_update_date,
	last_updated_by,
	creation_date,
	created_by,
	last_update_login,
	request_id,
	program_application_id,
	program_id,
	program_update_date,
	initialization_date,
	completion_date,
	ship_date,
	current_status,
	revision,
	lot_number,
	fixed_asset_tag,
	reserved_order_id,
	parent_item_id,
	parent_serial_number,
	original_wip_entity_id,
	original_unit_vendor_id,
	vendor_serial_number,
	vendor_lot_number,
	last_txn_source_type_id,
	last_transaction_id,
	last_receipt_issue_type,
	last_txn_source_name,
	last_txn_source_id,
	descriptive_text,
	current_subinventory_code,
	current_locator_id,
	current_organization_id,
	attribute_category,
	attribute1,
	attribute2,
	attribute3,
	attribute4,
	attribute5,
	attribute6,
	attribute7,
	attribute8,
	attribute9,
	attribute10,
	attribute11,
	attribute12,
	attribute13,
	attribute14,
	attribute15,
	group_mark_id,
	line_mark_id,
	lot_line_mark_id,
	end_item_unit_number,
	gen_object_id,
	serial_attribute_category,
	origination_date,
	c_attribute1,
	c_attribute2,
	c_attribute3,
	c_attribute4,
	c_attribute5,
	c_attribute6,
	c_attribute7,
	c_attribute8,
	c_attribute9,
	c_attribute10,
	c_attribute11,
	c_attribute12,
	c_attribute13,
	c_attribute14,
	c_attribute15,
	c_attribute16,
	c_attribute17,
	c_attribute18,
	c_attribute19,
	c_attribute20,
	d_attribute1,
	d_attribute2,
	d_attribute3,
	d_attribute4,
	d_attribute5,
	d_attribute6,
	d_attribute7,
	d_attribute8,
	d_attribute9,
	d_attribute10,
	n_attribute1,
	n_attribute2,
	n_attribute3,
	n_attribute4,
	n_attribute5,
	n_attribute6,
	n_attribute7,
	n_attribute8,
	n_attribute9,
	n_attribute10,
	status_id,
	territory_code,
	cost_group_id,
	time_since_new,
	cycles_since_new,
	time_since_overhaul,
	cycles_since_overhaul,
	time_since_repair,
	cycles_since_repair,
	time_since_visit,
	cycles_since_visit,
	time_since_mark,
	cycles_since_mark,
	number_of_repairs,
	lpn_id,
	inspection_status,
	previous_status,
	lpn_txn_error_flag,
	wip_accounting_class_code,
	maintainable_flag,
	owning_department_id,
	dependent_asset_flag,
	network_asset_flag,
	fa_asset_id,
	pn_location_id,
	eam_location_id,
	asset_criticality_code,
	category_id,
	prod_organization_id,
	equipment_item_id,
	eqp_serial_number,
	organization_type,
	owning_organization_id,
	owning_tp_type,
	planning_organization_id,
	planning_tp_type,
	onhand_quantities_id,
	wip_entity_id,
	operation_seq_num,
	intraoperation_step_type,
	eam_instantiation_flag,
	eam_linear_location_id,
	reservation_id,
	availability_type,
	inventory_atp_code,
	reservable_type,
	parent_lot_number,
	operational_log_flag,
	operational_status_flag,
	c_attribute21,
	c_attribute22,
	c_attribute23,
	c_attribute24,
	c_attribute25,
	c_attribute26,
	c_attribute27,
	c_attribute28,
	c_attribute29,
	c_attribute30,
	n_attribute11,
	n_attribute12,
	n_attribute13,
	n_attribute14,
	n_attribute15,
	n_attribute16,
	n_attribute17,
	n_attribute18,
	n_attribute19,
	n_attribute20,
	n_attribute21,
	n_attribute22,
	n_attribute23,
	n_attribute24,
	n_attribute25,
	n_attribute26,
	n_attribute27,
	n_attribute28,
	n_attribute29,
	n_attribute30,
	country_of_origin,
	mcc_code,
	kca_operation,
	kca_seq_id,
	kca_seq_date)
(
	select
		
	inventory_item_id,
	serial_number,
	last_update_date,
	last_updated_by,
	creation_date,
	created_by,
	last_update_login,
	request_id,
	program_application_id,
	program_id,
	program_update_date,
	initialization_date,
	completion_date,
	ship_date,
	current_status,
	revision,
	lot_number,
	fixed_asset_tag,
	reserved_order_id,
	parent_item_id,
	parent_serial_number,
	original_wip_entity_id,
	original_unit_vendor_id,
	vendor_serial_number,
	vendor_lot_number,
	last_txn_source_type_id,
	last_transaction_id,
	last_receipt_issue_type,
	last_txn_source_name,
	last_txn_source_id,
	descriptive_text,
	current_subinventory_code,
	current_locator_id,
	current_organization_id,
	attribute_category,
	attribute1,
	attribute2,
	attribute3,
	attribute4,
	attribute5,
	attribute6,
	attribute7,
	attribute8,
	attribute9,
	attribute10,
	attribute11,
	attribute12,
	attribute13,
	attribute14,
	attribute15,
	group_mark_id,
	line_mark_id,
	lot_line_mark_id,
	end_item_unit_number,
	gen_object_id,
	serial_attribute_category,
	origination_date,
	c_attribute1,
	c_attribute2,
	c_attribute3,
	c_attribute4,
	c_attribute5,
	c_attribute6,
	c_attribute7,
	c_attribute8,
	c_attribute9,
	c_attribute10,
	c_attribute11,
	c_attribute12,
	c_attribute13,
	c_attribute14,
	c_attribute15,
	c_attribute16,
	c_attribute17,
	c_attribute18,
	c_attribute19,
	c_attribute20,
	d_attribute1,
	d_attribute2,
	d_attribute3,
	d_attribute4,
	d_attribute5,
	d_attribute6,
	d_attribute7,
	d_attribute8,
	d_attribute9,
	d_attribute10,
	n_attribute1,
	n_attribute2,
	n_attribute3,
	n_attribute4,
	n_attribute5,
	n_attribute6,
	n_attribute7,
	n_attribute8,
	n_attribute9,
	n_attribute10,
	status_id,
	territory_code,
	cost_group_id,
	time_since_new,
	cycles_since_new,
	time_since_overhaul,
	cycles_since_overhaul,
	time_since_repair,
	cycles_since_repair,
	time_since_visit,
	cycles_since_visit,
	time_since_mark,
	cycles_since_mark,
	number_of_repairs,
	lpn_id,
	inspection_status,
	previous_status,
	lpn_txn_error_flag,
	wip_accounting_class_code,
	maintainable_flag,
	owning_department_id,
	dependent_asset_flag,
	network_asset_flag,
	fa_asset_id,
	pn_location_id,
	eam_location_id,
	asset_criticality_code,
	category_id,
	prod_organization_id,
	equipment_item_id,
	eqp_serial_number,
	organization_type,
	owning_organization_id,
	owning_tp_type,
	planning_organization_id,
	planning_tp_type,
	onhand_quantities_id,
	wip_entity_id,
	operation_seq_num,
	intraoperation_step_type,
	eam_instantiation_flag,
	eam_linear_location_id,
	reservation_id,
	availability_type,
	inventory_atp_code,
	reservable_type,
	parent_lot_number,
	operational_log_flag,
	operational_status_flag,
	c_attribute21,
	c_attribute22,
	c_attribute23,
	c_attribute24,
	c_attribute25,
	c_attribute26,
	c_attribute27,
	c_attribute28,
	c_attribute29,
	c_attribute30,
	n_attribute11,
	n_attribute12,
	n_attribute13,
	n_attribute14,
	n_attribute15,
	n_attribute16,
	n_attribute17,
	n_attribute18,
	n_attribute19,
	n_attribute20,
	n_attribute21,
	n_attribute22,
	n_attribute23,
	n_attribute24,
	n_attribute25,
	n_attribute26,
	n_attribute27,
	n_attribute28,
	n_attribute29,
	n_attribute30,
	country_of_origin,
	mcc_code,
	kca_operation,
	kca_seq_id ,
	kca_seq_date from bec_raw_dl_ext.MTL_SERIAL_NUMBERS
	where kca_operation != 'DELETE'  and nvl(kca_seq_id,'')!= '' 
	and (SERIAL_NUMBER,INVENTORY_ITEM_ID,CURRENT_ORGANIZATION_ID,kca_seq_id) in 
	(select SERIAL_NUMBER,INVENTORY_ITEM_ID,CURRENT_ORGANIZATION_ID,max(kca_seq_id) from bec_raw_dl_ext.MTL_SERIAL_NUMBERS 
     where kca_operation != 'DELETE'  and nvl(kca_seq_id,'')!= ''
     group by SERIAL_NUMBER,INVENTORY_ITEM_ID,CURRENT_ORGANIZATION_ID)
        and	( kca_seq_date > (
		select
			(executebegints-prune_days)
		from
			bec_etl_ctrl.batch_ods_info
		where
			ods_table_name = 'mtl_serial_numbers')
		 
            )	
);
end; 





/*
# Copyright(c) 2022 KPI Partners, Inc. All Rights Reserved.
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#
# author: KPI Partners, Inc.
# version: 2022.06
# description: This script represents full load approach for ODS.
# File Version: KPI v1.0
*/

begin;

DROP TABLE if exists bec_ods.JTF_TASKS_B;

CREATE TABLE IF NOT EXISTS bec_ods.JTF_TASKS_B
(
	TASK_ID  NUMERIC(15,0) ENCODE az64, 
	CREATED_BY  NUMERIC(15,0) ENCODE az64, 
	CREATION_DATE  TIMESTAMP WITHOUT TIME ZONE ENCODE az64, 
	LAST_UPDATED_BY  NUMERIC(15,0) ENCODE az64, 
	LAST_UPDATE_DATE  TIMESTAMP WITHOUT TIME ZONE ENCODE az64, 
	LAST_UPDATE_LOGIN  NUMERIC(15,0) ENCODE az64, 
	OBJECT_VERSION_NUMBER  NUMERIC(15,0) ENCODE az64, 
	TASK_NUMBER  VARCHAR(30) ENCODE LZO, 
	TASK_TYPE_ID  NUMERIC(15,0) ENCODE az64, 
	TASK_STATUS_ID  NUMERIC(15,0) ENCODE az64, 
	TASK_PRIORITY_ID  NUMERIC(15,0) ENCODE az64, 
	OWNER_ID  NUMERIC(15,0) ENCODE az64, 
	OWNER_TYPE_CODE  VARCHAR(30) ENCODE LZO, 
	OWNER_TERRITORY_ID  NUMERIC(15,0) ENCODE az64, 
	ASSIGNED_BY_ID  NUMERIC(15,0) ENCODE az64, 
	CUST_ACCOUNT_ID  NUMERIC(15,0) ENCODE az64, 
	CUSTOMER_ID  NUMERIC(15,0) ENCODE az64, 
	ADDRESS_ID  NUMERIC(15,0) ENCODE az64, 
	PLANNED_START_DATE  TIMESTAMP WITHOUT TIME ZONE ENCODE az64, 
	PLANNED_END_DATE  TIMESTAMP WITHOUT TIME ZONE ENCODE az64, 
	SCHEDULED_START_DATE  TIMESTAMP WITHOUT TIME ZONE ENCODE az64, 
	SCHEDULED_END_DATE  TIMESTAMP WITHOUT TIME ZONE ENCODE az64, 
	ACTUAL_START_DATE  TIMESTAMP WITHOUT TIME ZONE ENCODE az64, 
	ACTUAL_END_DATE  TIMESTAMP WITHOUT TIME ZONE ENCODE az64, 
	SOURCE_OBJECT_TYPE_CODE  VARCHAR(30) ENCODE LZO, 
	TIMEZONE_ID  NUMERIC(15,0) ENCODE az64, 
	SOURCE_OBJECT_ID  NUMERIC(15,0) ENCODE az64, 
	SOURCE_OBJECT_NAME  VARCHAR(80) ENCODE LZO, 
	DURATION  NUMERIC(28,10) ENCODE az64, 
	DURATION_UOM  VARCHAR(3) ENCODE LZO, 
	PLANNED_EFFORT  NUMERIC(28,10) ENCODE az64, 
	PLANNED_EFFORT_UOM  VARCHAR(3) ENCODE LZO, 
	ACTUAL_EFFORT  NUMERIC(28,10) ENCODE az64, 
	ACTUAL_EFFORT_UOM  VARCHAR(3) ENCODE LZO, 
	PERCENTAGE_COMPLETE  NUMERIC(28,10) ENCODE az64, 
	REASON_CODE  VARCHAR(30) ENCODE LZO, 
	PRIVATE_FLAG  VARCHAR(1) ENCODE LZO, 
	PUBLISH_FLAG  VARCHAR(1) ENCODE LZO, 
	RESTRICT_CLOSURE_FLAG  VARCHAR(1) ENCODE LZO, 
	MULTI_BOOKED_FLAG  VARCHAR(1) ENCODE LZO, 
	MILESTONE_FLAG  VARCHAR(1) ENCODE LZO, 
	HOLIDAY_FLAG  VARCHAR(1) ENCODE LZO, 
	BILLABLE_FLAG  VARCHAR(1) ENCODE LZO, 
	BOUND_MODE_CODE  VARCHAR(30) ENCODE LZO, 
	SOFT_BOUND_FLAG  VARCHAR(1) ENCODE LZO, 
	WORKFLOW_PROCESS_ID  NUMERIC(15,0) ENCODE az64, 
	NOTIFICATION_FLAG  VARCHAR(1) ENCODE LZO, 
	NOTIFICATION_PERIOD  NUMERIC(28,10) ENCODE az64, 
	NOTIFICATION_PERIOD_UOM  VARCHAR(3) ENCODE LZO, 
	PARENT_TASK_ID  NUMERIC(15,0) ENCODE az64, 
	RECURRENCE_RULE_ID  NUMERIC(15,0) ENCODE az64, 
	ALARM_START  NUMERIC(28,10) ENCODE az64, 
	ALARM_START_UOM  VARCHAR(3) ENCODE LZO, 
	ALARM_ON  VARCHAR(1) ENCODE LZO, 
	ALARM_COUNT  NUMERIC(28,10) ENCODE az64, 
	ALARM_FIRED_COUNT  NUMERIC(28,10) ENCODE az64, 
	ALARM_INTERVAL  NUMERIC(28,10) ENCODE az64, 
	ALARM_INTERVAL_UOM  VARCHAR(3) ENCODE LZO, 
	DELETED_FLAG  VARCHAR(1) ENCODE LZO, 
	PALM_FLAG  VARCHAR(1) ENCODE LZO, 
	WINCE_FLAG  VARCHAR(1) ENCODE LZO, 
	LAPTOP_FLAG  VARCHAR(1) ENCODE LZO, 
	DEVICE1_FLAG  VARCHAR(1) ENCODE LZO, 
	DEVICE2_FLAG  VARCHAR(1) ENCODE LZO, 
	DEVICE3_FLAG  VARCHAR(1) ENCODE LZO, 
	COSTS  NUMERIC(28,10) ENCODE az64, 
	CURRENCY_CODE  VARCHAR(15) ENCODE LZO, 
	ORG_ID  NUMERIC(15,0) ENCODE az64, 
	ESCALATION_LEVEL  VARCHAR(30) ENCODE LZO, 
	ATTRIBUTE1  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE2  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE3  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE4  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE5  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE6  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE7  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE8  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE9  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE10  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE11  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE12  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE13  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE14  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE15  VARCHAR(150) ENCODE LZO, 
	ATTRIBUTE_CATEGORY  VARCHAR(150) ENCODE LZO, 
	SECURITY_GROUP_ID  NUMERIC(15,0) ENCODE az64, 
	ORIG_SYSTEM_REFERENCE  VARCHAR(60) ENCODE LZO, 
	ORIG_SYSTEM_REFERENCE_ID  NUMERIC(15,0) ENCODE az64, 
	UPDATE_STATUS_FLAG  VARCHAR(1) ENCODE LZO, 
	CALENDAR_START_DATE  TIMESTAMP WITHOUT TIME ZONE ENCODE az64, 
	CALENDAR_END_DATE  TIMESTAMP WITHOUT TIME ZONE ENCODE az64, 
	DATE_SELECTED  VARCHAR(1) ENCODE LZO, 
	TEMPLATE_ID  NUMERIC(15,0) ENCODE az64, 
	TEMPLATE_GROUP_ID  NUMERIC(15,0) ENCODE az64, 
	OBJECT_CHANGED_DATE  TIMESTAMP WITHOUT TIME ZONE ENCODE az64, 
	TASK_CONFIRMATION_STATUS  VARCHAR(1) ENCODE LZO, 
	TASK_CONFIRMATION_COUNTER  NUMERIC(28,10) ENCODE az64, 
	TASK_SPLIT_FLAG  VARCHAR(1) ENCODE LZO, 
	OPEN_FLAG  VARCHAR(1) ENCODE LZO, 
	ENTITY  VARCHAR(30) ENCODE LZO, 
	CHILD_POSITION  VARCHAR(1) ENCODE LZO, 
	CHILD_SEQUENCE_NUM  NUMERIC(15,0) ENCODE az64, 
	LOCATION_ID  NUMERIC(15,0) ENCODE az64, 
	CRITICAL_TASK_FLAG  VARCHAR(1) ENCODE LZO, 
	CUST_IMP_LEVEL  NUMERIC(15,0) ENCODE az64, 
	FOLLOW_UP_TASK_FLAG  VARCHAR(1) ENCODE LZO, 
	BASE_TASK_ID  NUMERIC(15,0) ENCODE az64,
	KCA_OPERATION VARCHAR(10)   ENCODE lzo,
    IS_DELETED_FLG VARCHAR(2) ENCODE lzo,
	kca_seq_id NUMERIC(36,0)   ENCODE az64,
	kca_seq_date TIMESTAMP WITHOUT TIME ZONE ENCODE az64
)
DISTSTYLE
auto;

COMMIT;

INSERT INTO bec_ods.JTF_TASKS_B (
	TASK_ID, 
	CREATED_BY, 
	CREATION_DATE, 
	LAST_UPDATED_BY, 
	LAST_UPDATE_DATE, 
	LAST_UPDATE_LOGIN, 
	OBJECT_VERSION_NUMBER, 
	TASK_NUMBER, 
	TASK_TYPE_ID, 
	TASK_STATUS_ID, 
	TASK_PRIORITY_ID, 
	OWNER_ID, 
	OWNER_TYPE_CODE, 
	OWNER_TERRITORY_ID, 
	ASSIGNED_BY_ID, 
	CUST_ACCOUNT_ID, 
	CUSTOMER_ID, 
	ADDRESS_ID, 
	PLANNED_START_DATE, 
	PLANNED_END_DATE, 
	SCHEDULED_START_DATE, 
	SCHEDULED_END_DATE, 
	ACTUAL_START_DATE, 
	ACTUAL_END_DATE, 
	SOURCE_OBJECT_TYPE_CODE, 
	TIMEZONE_ID, 
	SOURCE_OBJECT_ID, 
	SOURCE_OBJECT_NAME, 
	DURATION, 
	DURATION_UOM, 
	PLANNED_EFFORT, 
	PLANNED_EFFORT_UOM, 
	ACTUAL_EFFORT, 
	ACTUAL_EFFORT_UOM, 
	PERCENTAGE_COMPLETE, 
	REASON_CODE, 
	PRIVATE_FLAG, 
	PUBLISH_FLAG, 
	RESTRICT_CLOSURE_FLAG, 
	MULTI_BOOKED_FLAG, 
	MILESTONE_FLAG, 
	HOLIDAY_FLAG, 
	BILLABLE_FLAG, 
	BOUND_MODE_CODE, 
	SOFT_BOUND_FLAG, 
	WORKFLOW_PROCESS_ID, 
	NOTIFICATION_FLAG, 
	NOTIFICATION_PERIOD, 
	NOTIFICATION_PERIOD_UOM, 
	PARENT_TASK_ID, 
	RECURRENCE_RULE_ID, 
	ALARM_START, 
	ALARM_START_UOM, 
	ALARM_ON, 
	ALARM_COUNT, 
	ALARM_FIRED_COUNT, 
	ALARM_INTERVAL, 
	ALARM_INTERVAL_UOM, 
	DELETED_FLAG, 
	PALM_FLAG, 
	WINCE_FLAG, 
	LAPTOP_FLAG, 
	DEVICE1_FLAG, 
	DEVICE2_FLAG, 
	DEVICE3_FLAG, 
	COSTS, 
	CURRENCY_CODE, 
	ORG_ID, 
	ESCALATION_LEVEL, 
	ATTRIBUTE1, 
	ATTRIBUTE2, 
	ATTRIBUTE3, 
	ATTRIBUTE4, 
	ATTRIBUTE5, 
	ATTRIBUTE6, 
	ATTRIBUTE7, 
	ATTRIBUTE8, 
	ATTRIBUTE9, 
	ATTRIBUTE10, 
	ATTRIBUTE11, 
	ATTRIBUTE12, 
	ATTRIBUTE13, 
	ATTRIBUTE14, 
	ATTRIBUTE15, 
	ATTRIBUTE_CATEGORY, 
	SECURITY_GROUP_ID, 
	ORIG_SYSTEM_REFERENCE, 
	ORIG_SYSTEM_REFERENCE_ID, 
	UPDATE_STATUS_FLAG, 
	CALENDAR_START_DATE, 
	CALENDAR_END_DATE, 
	DATE_SELECTED, 
	TEMPLATE_ID, 
	TEMPLATE_GROUP_ID, 
	OBJECT_CHANGED_DATE, 
	TASK_CONFIRMATION_STATUS, 
	TASK_CONFIRMATION_COUNTER, 
	TASK_SPLIT_FLAG, 
	OPEN_FLAG, 
	ENTITY, 
	CHILD_POSITION, 
	CHILD_SEQUENCE_NUM, 
	LOCATION_ID, 
	CRITICAL_TASK_FLAG, 
	CUST_IMP_LEVEL, 
	FOLLOW_UP_TASK_FLAG, 
	BASE_TASK_ID,
	KCA_OPERATION,
	IS_DELETED_FLG,
	kca_seq_id,
	kca_seq_date
)
    SELECT
		TASK_ID, 
		CREATED_BY, 
		CREATION_DATE, 
		LAST_UPDATED_BY, 
		LAST_UPDATE_DATE, 
		LAST_UPDATE_LOGIN, 
		OBJECT_VERSION_NUMBER, 
		TASK_NUMBER, 
		TASK_TYPE_ID, 
		TASK_STATUS_ID, 
		TASK_PRIORITY_ID, 
		OWNER_ID, 
		OWNER_TYPE_CODE, 
		OWNER_TERRITORY_ID, 
		ASSIGNED_BY_ID, 
		CUST_ACCOUNT_ID, 
		CUSTOMER_ID, 
		ADDRESS_ID, 
		PLANNED_START_DATE, 
		PLANNED_END_DATE, 
		SCHEDULED_START_DATE, 
		SCHEDULED_END_DATE, 
		ACTUAL_START_DATE, 
		ACTUAL_END_DATE, 
		SOURCE_OBJECT_TYPE_CODE, 
		TIMEZONE_ID, 
		SOURCE_OBJECT_ID, 
		SOURCE_OBJECT_NAME, 
		DURATION, 
		DURATION_UOM, 
		PLANNED_EFFORT, 
		PLANNED_EFFORT_UOM, 
		ACTUAL_EFFORT, 
		ACTUAL_EFFORT_UOM, 
		PERCENTAGE_COMPLETE, 
		REASON_CODE, 
		PRIVATE_FLAG, 
		PUBLISH_FLAG, 
		RESTRICT_CLOSURE_FLAG, 
		MULTI_BOOKED_FLAG, 
		MILESTONE_FLAG, 
		HOLIDAY_FLAG, 
		BILLABLE_FLAG, 
		BOUND_MODE_CODE, 
		SOFT_BOUND_FLAG, 
		WORKFLOW_PROCESS_ID, 
		NOTIFICATION_FLAG, 
		NOTIFICATION_PERIOD, 
		NOTIFICATION_PERIOD_UOM, 
		PARENT_TASK_ID, 
		RECURRENCE_RULE_ID, 
		ALARM_START, 
		ALARM_START_UOM, 
		ALARM_ON, 
		ALARM_COUNT, 
		ALARM_FIRED_COUNT, 
		ALARM_INTERVAL, 
		ALARM_INTERVAL_UOM, 
		DELETED_FLAG, 
		PALM_FLAG, 
		WINCE_FLAG, 
		LAPTOP_FLAG, 
		DEVICE1_FLAG, 
		DEVICE2_FLAG, 
		DEVICE3_FLAG, 
		COSTS, 
		CURRENCY_CODE, 
		ORG_ID, 
		ESCALATION_LEVEL, 
		ATTRIBUTE1, 
		ATTRIBUTE2, 
		ATTRIBUTE3, 
		ATTRIBUTE4, 
		ATTRIBUTE5, 
		ATTRIBUTE6, 
		ATTRIBUTE7, 
		ATTRIBUTE8, 
		ATTRIBUTE9, 
		ATTRIBUTE10, 
		ATTRIBUTE11, 
		ATTRIBUTE12, 
		ATTRIBUTE13, 
		ATTRIBUTE14, 
		ATTRIBUTE15, 
		ATTRIBUTE_CATEGORY, 
		SECURITY_GROUP_ID, 
		ORIG_SYSTEM_REFERENCE, 
		ORIG_SYSTEM_REFERENCE_ID, 
		UPDATE_STATUS_FLAG, 
		CALENDAR_START_DATE, 
		CALENDAR_END_DATE, 
		DATE_SELECTED, 
		TEMPLATE_ID, 
		TEMPLATE_GROUP_ID, 
		OBJECT_CHANGED_DATE, 
		TASK_CONFIRMATION_STATUS, 
		TASK_CONFIRMATION_COUNTER, 
		TASK_SPLIT_FLAG, 
		OPEN_FLAG, 
		ENTITY, 
		CHILD_POSITION, 
		CHILD_SEQUENCE_NUM, 
		LOCATION_ID, 
		CRITICAL_TASK_FLAG, 
		CUST_IMP_LEVEL, 
		FOLLOW_UP_TASK_FLAG, 
		BASE_TASK_ID,
		KCA_OPERATION,
		'N' as IS_DELETED_FLG,
		cast(NULLIF(KCA_SEQ_ID,'') as numeric(36,0)) as KCA_SEQ_ID,
		kca_seq_date
    FROM
        bec_ods_stg.JTF_TASKS_B;

end;		

UPDATE bec_etl_ctrl.batch_ods_info
SET
    load_type = 'I',
    last_refresh_date = getdate()
WHERE
    ods_table_name = 'jtf_tasks_b';
	
commit;